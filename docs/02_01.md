# 1. Terminologie et architecture d'Ansible

## 1.1. Introduction aux éléments Ansible

Dans cette leçon où nous allons explorer la terminologie clé utilisée dans **Ansible**.

Comprendre ces termes est crucial pour travailler efficacement avec cet outil d'automatisation.

C'est simplement une rapide introduction à chacun des composants principaux d'**Ansible**, nous les verrons bien sûr très en détail pendant la formation.

![Architecture et Terminologie de Ansible](./images/02_01_ansible_terminology_and_architecture.svg)

## 1.2. Résumé des éléments principaux

En résumé, dans un environnement **Ansible**, le **control node** est la machine à partir de laquelle les tâches d'automatisation sont lancées.

Les **managed nodes** sont les hôtes que l'on souhaite configurer et gérer.

Pour établir quels **managed nodes** sont ciblés pour l'exécution de tâches, on utilise un **inventory** qui peut également organiser ces **nodes** en **groupes** pour faciliter leur gestion.

Des **vars** peuvent être définies au niveau des **groups** ou des **hosts** pour spécifier des variables qui affecteront le comportement des **tasks**.

Un **playbook** contient une série de **tasks** à exécuter sur les **managed nodes**.

Chaque **task** appelle un **module** qui exécute une action spécifique, comme l'installation d'un paquet ou la copie d'un fichier.

Les **roles** permettent de regrouper des **tasks**, des **vars** et des fichiers de configuration pour une réusabilité et une organisation améliorées.

Les **plugins** ajoutent des fonctionnalités supplémentaires, comme le filtrage des données ou l'amélioration des capacités de **logging**.

Tous ces éléments travaillent ensemble pour fournir un système d'automatisation puissant et flexible qui peut gérer une multitude de scénarios complexes avec une syntaxe simple et compréhensible.

## 1.3. control node / managed node

Dans **Ansible**, le **control node** est la machine où **Ansible** est installé et à partir de laquelle les tâches d'automatisation sont exécutées.

Les **managed nodes** sont les serveurs sur lesquels les tâches seront effectuées.

Exemple :

- **control node** : votre propre machine locale ou un serveur sécurisé.
- **managed nodes** : serveurs Web, bases de données, etc.

## 1.4. Inventory

L'**inventory** est un fichier qui contient la liste des **managed nodes** que le **control node** doit gérer.

Exemple :

```INI
[web]
192.168.1.1
192.168.1.2

[db]
192.168.1.3
```

### 1.4.1. groups

Dans un **inventory**, vous pouvez organiser les **managed nodes** en **groups**.

Cela permet de cibler un ensemble spécifique de machines lors de l'exécution des **playbooks**.

Par exemple ci-dessus : le groupe `[web]` contient les serveurs Web, et `[db]` contient les bases de données.

### 1.4.2. vars : groups / hosts

Les variables (**vars**) peuvent être définies au niveau des **groups** ou des **hosts** individuels pour un accès facile dans les **playbooks**.

```INI
[web]
192.168.1.1 http_port=80
192.168.1.2 http_port=8080

[web:vars]
nginx_version=1.18
```

## 1.5. modules / tasks et plugins

### 1.5.1. Les modules

Les **modules Ansible** sont des unités de code qui font le véritable travail dans **Ansible** : ils effectuent les tâches sur les **managed nodes**.

Un **module** prend des arguments et renvoie des informations au **control node**, généralement sous forme de **JSON**.

Les **modules** peuvent exécuter une grande variété d'opérations, y compris, mais sans s'y limiter, la gestion des paquets, la création de fichiers, la gestion des services système, et même l'interaction avec des **API** et des services externes.

Par exemple, le module **apt** pour gérer les paquets sur des systèmes **Debian**.

### 1.5.2. Les tasks

Les **tasks** sont les actions individuelles que **Ansible** exécutera sur les **managed nodes**. Une **task** utilise un **module**.

Chaque **task** dans un **playbook** appelle un **module** spécifique et lui passe un ensemble d'arguments.

Exemple :

```YAML
- name: install nginx
  apt:
    name: nginx
    state: present
```

Autre exemple :

```YAML
- name: cpoy nginx configuration file
  copy:
    src: /local/nginx.conf
    dest: /etc/nginx/nginx.conf
```

### 1.5.3. Les plugins

Les **plugins** étendent les fonctionnalités d'**Ansible**. Il en existe de plusieurs types, y compris des lookup plugins, des filter plugins, etc.

Par exemple, un **plugin** de recherche pour consulter les données dans un service **AWS S3**.

## 1.6. Les rôles

Les **roles** permettent de regrouper des **tasks**, des **vars**, des fichiers et d'autres composants **Ansible** en une structure organisée.

Par exemple, un rôle **web_server** qui installe et configure Nginx.

## 1.7. Les playbooks

Les **playbooks** sont des fichiers **YAML** qui définissent quelles **tasks** exécuter et dans quel ordre. Ils peuvent inclure des **vars**, des **tasks**, et même d'autres **playbooks**.

```YAML
---
- name: configure web servers
  hosts: web
  roles:
    - web_server
```
