# 5. Définition de valeurs interactives avec vars_prompt

## 5.1. Utilisation de vars_prompt

Vous pouvez également utiliser **vars_prompt** dans les **playbooks** pour demander des informations à l'utilisateur au début de l'exécution.

Cela permet de saisir des valeurs de variables sensibles ou spécifiques à une instance, telles que des mots de passe, des noms d'utilisateur, ou tout autre type de donnée nécessaire à l'exécution du **playbook**.

Les valeurs saisies sont ensuite utilisées comme variables pendant l'exécution.

## 5.2. Syntaxe de base

Voici un exemple basique qui montre comment demander le nom d'utilisateur et le mot de passe :

```YAML
- hosts: localhost
  vars_prompt:
    - name: username
      prompt: "What is your username?"
      private: false  # The username is displayed while typing

    - name: password
      prompt: "What is your password?"
      private: true   # The password is hidden while typing

  tasks:
    - name: Display a message
      ansible.builtin.debug:
        msg: "Login as {{ username }}"
```

## 5.3. Gestion des valeurs par défaut

Vous pouvez fournir une valeur par défaut pour une variable, qui peut être remplacée par l'entrée de l'utilisateur :

```YAML
vars_prompt:
  - name: release_version
    prompt: "Product release version"
    default: "1.0"
```

## 5.4. Hashage des valeurs saisies

Pour des raisons de sécurité, notamment pour les mots de passe, vous pouvez hasher les valeurs saisies à l'aide de **vars_prompt**.

Par exemple, pour utiliser un mot de passe avec le module utilisateur, vous pouvez le hasher en utilisant **sha512_crypt** :

```YAML
vars_prompt:
  - name: my_password
    prompt: "Enter your password"
    private: true
    encrypt: sha512_crypt
    confirm: true
    salt_size: 7
```

Notez également l'utilisation de **confirm** pour une confirmation.

## 5.5. Exemple

Un cas d'utilisation courant du hachage de mot de passe est avec l'utilisation du module **user** pour créer un utilisateur (`johndoe`) avec un mot de passe :

```YAML
---
- hosts: all
  vars_prompt:
    - name: user_password
      prompt: "Enter the user password"
      private: true
      encrypt: sha512_crypt
      confirm: true
      salt_size: 7

  tasks:
    - name: Create a new user with the hashed password
      ansible.builtin.user:
        name: "johndoe"
        password: "{{ user_password }}"
        state: present
```

Dans l'exemple ci-dessus, le mot de passe haché est directement passé à la tâche qui crée l'utilisateur.

Le module `ansible.builtin.user` prend en charge l'utilisation de mots de passe hachés, ce qui signifie que le mot de passe que vous passez doit être déjà sous une forme chiffrée que le système cible peut comprendre et utiliser.
