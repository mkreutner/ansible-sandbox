# 4. Définir des variables au niveau de l'hôte pendant l'exécution avec le module set_fact

## 4.1. Le module set_fact

Le module `ansible.builtin.set_fact` est un outil puissant pour définir dynamiquement des variables au niveau de l'hôte pendant l'exécution d'un **playbook**.

Ces variables peuvent être utilisés ultérieurement dans le **playbook**, ce qui rend vos automatisations plus dynamiques et adaptables aux contextes spécifiques de chaque hôte.

## 4.2. Les paramètres

- **key_value** : définit les variables dans un format clé-valeur. La clé représente le nom de la variable, et la valeur représente la donnée que vous souhaitez stocker.
- **cacheable** : lorsque **cacheable** est défini sur **true**, la variable n'est pas seulement enregistrée comme une variable d'hôte normale, mais est également convertie en un "fait", ce qui signifie qu'elle peut être ajoutée au cache de faits d'**Ansible**. C'est utile pour maintenir la persistance des variables sur plusieurs exécutions de **playbook**, à condition que le cache de faits soit configuré. Ce paramètre est avancé.

## 4.3. Exemples

### 4.3.1. Créer des listes et des dictionnaires

```YAML
- name: Create lists and dictionaries
  ansible.builtin.set_fact:
    a_list: [element1, element2]
    a_dictionary:
      key: value
      other_key: other_value
```

Vous pouvez aussi utiliser le format avec des tirets (`-`) pour les listes.

### 4.3.2. Récupérer des versions systèmes et les stocker

```YAML
- name: Retrieve system versions on Ubuntu hosts
  hosts: localhost
  gather_facts: false

  tasks:
    - name: Retrieve Ubuntu Version
      ansible.builtin.command: lsb_release -a
      register: ubuntu_version
      changed_when: false
    - name: Retrieve the Bash version
      ansible.builtin.command: bash --version
      register: bash_version
      changed_when: false
    - name: Retrieve Ubuntu Version
      ansible.builtin.set_fact:
        ubuntu_version_fact: "{{ ubuntu_version.stdout_lines[2].split('\t')[1] }}"
    - name: Retrieve the Bash version
      ansible.builtin.set_fact:
        bash_version_fact: "{{ bash_version.stdout_lines[0].split(',')[1].split('version ')[1] }}"
    - name: Show recovered versions
      ansible.builtin.debug:
        msg:
          - "Version Ubuntu: {{ ubuntu_version_fact | default('Not detected') }}"
          - "Version Bash  : {{ bash_version_fact | default('Not detected') }}"
```
