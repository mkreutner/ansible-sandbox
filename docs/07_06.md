# 6. Tester plusieurs conditions avec le module assert

## 6.1. Le module assert

Le module `ansible.builtin.assert` est un outil puissant pour la vérification de conditions au sein de vos **playbooks**.

Il sert essentiellement à assurer que certaines conditions ou affirmations sont vraies lors de l'exécution des tâches.

Si une affirmation échoue, la tâche s'arrête et renvoie un message d'erreur, ce qui peut être particulièrement utile pour la validation de pré-requis ou la vérification de l'état d'une configuration avant de procéder à des modifications supplémentaires

## 6.2. Synopsis

Ce module permet d'affirmer que des expressions données sont vraies et peut renvoyer un message personnalisé en cas de succès ou d'échec de ces affirmations.

Il est compatible aussi bien avec les cibles Windows que les autres systèmes d'exploitation.

## 6.3. Paramètres

- **fail_msg (alias msg)** : Un message personnalisé qui sera renvoyé si l'affirmation échoue. Ce paramètre est utile pour clarifier la raison de l'échec dans les logs ou les rapports d'erreurs.
- **quiet** : Ce paramètre booléen, lorsqu'il est réglé sur **true**, réduit la verbosité de la sortie du module. Il est utile pour limiter les informations affichées lors de l'exécution des **playbooks**.
- **success_msg** : Un message personnalisé qui sera affiché si toutes les affirmations passent. Cela permet de fournir des confirmations spécifiques de succès directement dans les logs d'exécution.
- **that** : Ce paramètre obligatoire prend une liste de chaînes de caractères contenant des expressions, semblables à celles utilisées dans les conditionnels **when**. Ces expressions sont évaluées et doivent toutes être vraies pour que le module ne renvoie pas d'erreur.

## 6.4. Exemples

```YAML
---
- name: Example of using conditions with register
  hosts: localhost
  gather_facts: false
  vars:
    my_var: 100
  tasks:
    - name: Ensure that 'my_var' is between 0 and 100 inclusive
      ansible.builtin.assert:
        that:
          - my_var <= 100
          - my_var >= 0
        fail_msg: "'my_var' must be between 0 and 100 inclusive"
        success_msg: "'my_var' is between 0 and 100 inclusive"
```

Voici un exemple plus réaliste :

```YAML
---
- name: Updating Packages on an Ubuntu System
  hosts: all
  become: true
  tasks:
    - name: Check that the system is Ubuntu
      ansible.builtin.assert:
        that:
          - ansible_facts.distribution == "Ubuntu"
        fail_msg: "This playbook can only be run on Ubuntu."
        success_msg: "The distribution is Ubuntu, continuation of the update process."

    - name: Update all packages on Ubuntu
      ansible.builtin.apt:
        update_cache: true
        upgrade: dist
```

La tâche "Check that the system is Ubuntu" utilise `ansible.builtin.assert` pour s'assurer que la distribution en cours est bien **Ubuntu**. Si ce n'est pas le cas, le **playbook** échoue et affiche le message d'erreur spécifié dans **fail_msg**. Si la condition est remplie, il affiche le message de succès et on passe à la tâche suivante.

Essayez maintenant cet exemple pour voir ce qui se passe en cas d'échec :

```YAML
---
- name: Updating Packages on a CentOS System
  hosts: all
  become: true

  tasks:
    - name: Check that the system is CentOS
      ansible.builtin.assert:
        that:
          - ansible_facts.distribution == "CentOS" or ansible_facts.distribution == "RedHat"
        fail_msg: "This playbook can only be run on CentOS or RedHat."
        success_msg: "The distribution is CentOS or RedHat, continuation of the update process."

    - name: Update all packages on CentOS
      ansible.builtin.yum:
        name: '*'
        state: latest
      when: ansible_facts.distribution == "CentOS" or ansible_facts.distribution == "RedHat"
```
