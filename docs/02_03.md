# 3. Premier playbook

## 3.1. Introduction à notre premier playbook

Dans cette leçon, nous allons découvrir comment créer un **playbook** **Ansible** pour automatiser des tâches sur des nœuds gérés.

Un **playbook** est un fichier **YAML** qui contient un ensemble d'instructions qu'**Ansible** exécutera dans un ordre spécifique.

Pour rappel :

- **Playbook** : une liste d'opérations que **Ansible** doit exécuter.
- **Play** : une partie spécifique d'un **playbook**, qui contient une liste ordonnée de tâches.
- **Task** : une action spécifique que **Ansible** doit exécuter.
- **Module** : une unité de code que **Ansible** utilise pour accomplir une tâche.

## 3.2. Créer le fichier playbook

Toujours sur notre container **ansible** et toujours dans le dossier `workspace/ansible`, créez un fichier `playbook.yaml` dans **VS Code** :

```YAML
- name: My first playbook
  hosts: containers
  tasks:
    - name: Ping my hosts
      ansible.builtin.ping: ~
    - name: Display message
      ansible.builtin.debug:
        msg: "Hello, Ansible!"
```

**ansible.builtin.ping** est le même module que celui que nous avions utilisé en ligne de commande (**-m ping**).

## 3.3. Exécuter le playbook

Dans votre terminal, naviguez jusqu'au répertoire où se trouve votre fichier `ansible.cfg` (normalement `workspace`) et exécutez la commande suivante :

```SHELL
uv run ansible-playbook ansible/playbook.yaml
```

Vous aurez en sortie :

```SHELL
PLAY [My first playbook] ***********************************************************************************************************************************************************************

TASK [Gathering Facts] *************************************************************************************************************************************************************************
ok: [server01]
ok: [server02]
ok: [server03]

TASK [Ping my hosts] ***************************************************************************************************************************************************************************
ok: [server02]
ok: [server01]
ok: [server03]

TASK [Display message] *************************************************************************************************************************************************************************
ok: [server01] => {
    "msg": "Hello, Ansible!"
}
ok: [server02] => {
    "msg": "Hello, Ansible!"
}
ok: [server03] => {
    "msg": "Hello, Ansible!"
}

PLAY RECAP *************************************************************************************************************************************************************************************
server01                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
server02                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
server03                   : ok=3    changed=0    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0
```

## 3.4. Comprendre la sortie

**PLAY [My first playbook]** : indique le début de l'exécution du playbook.

**TASK [Gathering Facts]** : par défaut, Ansible collecte des informations sur les noeuds gérés.

**TASK [Ping my hosts]** et **TASK [Display message]** : ce sont les tâches que vous avez définies dans votre playbook.

**PLAY RECAP** : un résumé des tâches exécutées sur chaque hôte.
