# 7. Le module debug

Le module `ansible.builtin.debug` est un outil essentiel dans **Ansible** pour afficher des informations de débogage pendant l'exécution des **playbooks**.

Il est intégré à toutes les installations d'**Ansible** et est utile pour diagnostiquer des problèmes, vérifier des valeurs de variables, ou simplement pour comprendre le déroulement de vos **playbooks**.

## 7.1. Synopsis

Ce module permet d'imprimer des messages ou des valeurs de variables pendant l'exécution d'un **playbook**.

C'est un outil de diagnostic qui ne modifie pas l'état de l'hôte mais fournit des informations qui peuvent aider à comprendre le comportement des tâches.

## 7.2. Paramètres

Le module peut prendre trois paramètres optionnels :

- **msg (string)**: message personnalisé à afficher. Si non spécifié, le module affichera `"Hello world!"` par défaut.
- **var (string)**: nom de la variable dont la valeur doit être affichée. Ce paramètre est mutuellement exclusif avec **msg**. La valeur de cette variable est évaluée dans le contexte de **Jinja2**, donc il n'est pas nécessaire d'utiliser les délimiteurs `{{ }}`. _Nous verrons en détail Jinja2 dans un chapitre dédié._
- **verbosity (integer)**: définit le niveau de verbosité nécessaire pour que le débogage soit effectué. Par exemple, une verbosité de 3 signifie que le message ne sera affiché que si Ansible est exécuté avec l'option `-vvv` ou plus.

## 7.3. Exemples

#### Obtenir et afficher les informations de fonctionnement du système

```YAML
- name: Debug module example
  hosts: localhost

  tasks:
    - name: Gets operating information
      ansible.builtin.shell: /usr/bin/uptime
      register: result

    - name: Displays the return information from the previous task
      ansible.builtin.debug:
        var: result
```

_Nous verrons en détail **register** dans le chapitre sur les variables._

#### Afficher toutes les variables d'un hôte

```YAML
- name: Debug module example
  hosts: localhost

  tasks:
    - name: Displays all known variables and facts for a host
      ansible.builtin.debug:
        var: hostvars[inventory_hostname]
```

#### Afficher la passerelle de chaque hôte

```YAML
- name: Debug module example
  hosts: localhost

  tasks:
    - name: Displays the gateway of each host if defined
      ansible.builtin.debug:
        msg: "The system {{ inventory_hostname }} uses the gateway {{ ansible_default_ipv4.gateway }}"
```

La **Public Gateway**, ou passerelle publique, est un dispositif réseau qui sert de point d'entrée ou de sortie entre deux réseaux, typiquement entre un réseau interne ou privé et Internet. Cette passerelle permet à des dispositifs du réseau interne de communiquer avec l'extérieur.

La passerelle agit comme un relais et un routeur pour le trafic entrant et sortant. Dans un réseau d'entreprise, la passerelle publique peut être configurée pour implémenter des règles de sécurité, filtrer le trafic, et effectuer d'autres fonctions de routage nécessaires pour gérer les communications entre les réseaux internes et externes.

La passerelle est souvent responsable de la traduction des adresses réseau (**NAT - Network Address Translation**) pour permettre aux multiples dispositifs d'un réseau privé d'accéder à **Internet** en utilisant une seule adresse **IP** publique. Elle peut également gérer le **VPN** (**Virtual Private Network**) et d'autres services de sécurité.

#### Debug avec une liste de messages

Vous pouvez passer une liste en argument de msg :

```YAML
---
- name: Debug Example with Message List
  hosts: localhost
  gather_facts: false
  vars:
    user_name: "{{ lookup('env', 'USER') }}"

  tasks:
    - name: Display multiple messages in a list
      ansible.builtin.debug:
        msg:
          - "This is a multiple message block:"
          - "Hello, {{ user_name }}! Welcome to this Ansible debugging session."
          - "We currently use Ansible to automate simple tasks."
```

#### Utiliser un niveau de verbosité

```YAML
---
- name: Debugging Example with Verbosity Control
  hosts: localhost
  gather_facts: false
  vars:
    user_name: "{{ lookup('env', 'USER') }}"

  tasks:
    - name: Displays a simple welcome message
      ansible.builtin.debug:
        msg: "Hello from Ansible!"
        verbosity: 1

    - name: Displays detailed information if verbosity is set to 2 or higher
      ansible.builtin.debug:
        msg: "Detailed information for the user: {{ user_name }}"
        verbosity: 2

    - name: Check an environment variable with additional verbosity details
      ansible.builtin.debug:
        msg: "USER environment variable details for high verbosity: '{{ user_name }}'"
        verbosity: 3
```

Il faudra utiliser respectivement, `-v`, `-vv` et `-vvv`. Faites l'essai pour voir quels messages s'affichent suivant le niveau de verbosité :

```SHELL
ansible-playbook -i inventory.yml playbooks/test.yml -vv
```
