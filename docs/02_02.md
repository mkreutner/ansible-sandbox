# 2. Premier inventaire

## 2.0. Création du fichier de configuration de Ansible

Créez le fichier `/home/developper/ansible.cfg` :

```INI
[defaults]
inventory = ~/workspace/ansible/inventory.yaml
remote_user = sysadm
private_key_file = ~/.ssh/ssh_key_developer
```

## 2.1. Création de l'inventaire

Créez le fichier `/home/developper/workspace/ansible/inventory.yaml` :

```YAML
containers:
  hosts:
    server01:
      ansible_host: 172.16.128.11
    server02:
      ansible_host: 172.16.128.12
    server03:
      ansible_host: 172.16.128.13
```

Nous verrons bien sûr les inventaires très en détail. Mais expliquons rapidement ce que cela signifie :

- **containers** : c'est le nom du groupe pour nos hôtes. Nous pouvons utiliser ce groupe lorsque nous exécutons des commandes **ansible** ou des **playbooks** en utilisant ce nom de groupe comme cible.
- **hosts** : ceci indique que vous allez lister les hôtes (ou machines) qui appartiennent à ce groupe.
- **server01**, **server02**, **server03** : ce sont les alias ou noms symboliques pour vos machines hôtes. Vous pouvez utiliser ces alias dans vos commandes **ansible** ou **playbooks** pour cibler ces machines spécifiques.
- **ansible_host: 172.16.128.11**, **ansible_host: 172.16.128.12**, **ansible_host: 172.16.128.13**: ces clés spécifient les adresses **IP** réelles de vos hôtes **server01**, **server02** et **server03**, respectivement. **Ansible** utilisera ces adresses **IP** pour se connecter aux machines lors de l'exécution de tâches.

## 2.2. Première utilisation d'un module

Dans le container **ansible**, dans le terminal de **VS Code**, dans le dossier **workspace** entrez :

```SHELL
uv run ansible -m ping containers
```

Cette commande **ansible** utilise le module **ping** pour vérifier si les hôtes spécifiés dans le fichier d'inventaire **inventory.yaml** sont accessibles.

Voici la décomposition de la commande :

- **ansible** : c'est le nom de la commande pour exécuter des opérations **Ansible** non structurées.
- **containers** : c'est le nom du **group** d'hôtes que vous souhaitez cibler. Ce nom doit correspondre à celui spécifié dans votre fichier d'inventaire (**inventory.yaml** dans cet exemple).
- **-m ping** : ici, **-m** signifie "**module**", et **ping** est le module **Ansible** que vous souhaitez exécuter. Le module **ping** sert à vérifier que les hôtes sont en ligne et accessibles via **SSH**. Il ne réalise pas un véritable "**ping**", mais il tente une connexion **SSH** et renvoie un "**pong**" si la connexion est réussie.

Lorsque cette commande est exécutée, **Ansible** lit le fichier **inventory.yaml**, trouve le groupe **containers**, et tente de se connecter à chaque hôte de ce groupe en utilisant **SSH**. Si la connexion est réussie, un "**pong**" est renvoyé, indiquant que l'hôte est accessible.

## 2.3. Notes sur les attaques MIM SSH

Une attaque "**man-in-the-middle**" (**MITM**) est une forme d'attaque active où un attaquant intercepte, relaie ou altère la communication entre deux parties sans que celles-ci ne se rendent compte que le lien entre elles a été compromis.

Dans le contexte de **SSH**, voici comment cela pourrait se dérouler :

1. **Interception de la connexion initiale** : l'attaquant se place entre vous (le client) et le serveur **SSH** auquel vous essayez de vous connecter. Le serveur pense qu'il parle au client et vice versa.
2. **Fausse identification** : lorsque le client demande la clé publique du serveur pour établir une connexion sécurisée, l'attaquant envoie sa propre clé publique au lieu de celle du serveur.
3. **Établissement de deux connexions séparées** : l'attaquant établit une connexion sécurisée avec le client en utilisant sa propre clé, et une autre connexion sécurisée avec le serveur en utilisant la clé du serveur. Le client pense qu'il communique de manière sécurisée avec le serveur, mais en réalité, toutes les communications passent par l'attaquant.

Si vous ne vérifiez pas l'empreinte digitale de la clé publique du serveur :

- Vous ne pourrez pas distinguer une clé légitime d'une clé fournie par un attaquant.
- L'attaquant pourra voir, intercepter et même modifier les données qui sont envoyées entre le client et le serveur.
- Les identifiants, tels que les mots de passe et les clés privées, peuvent être volés.

_Pour se protéger contre ces types d'attaques, il est important de vérifier l'empreinte digitale de la clé publique du serveur dans un contexte professionnel lors de la première connexion. Cela permet de s'assurer que vous vous connectez bien au serveur que vous pensez atteindre, établissant ainsi une forme de confiance pour les connexions futures._
